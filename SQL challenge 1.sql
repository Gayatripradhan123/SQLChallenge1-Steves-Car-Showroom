
create table salespersons(
salesman_id int primary key,
name varchar(50),
age int, 
city varchar(50)
);
INSERT into salespersons
(salesman_id,name,age,city)
values
(1, 'John Smith',28, 'New York'),
(2,'Emily Wong', 35, 'San Fran'),
(3, 'Tom Lee', 42, 'Seattle'),
(4, 'Lucy Chen', 31, 'LA');



CREATE TABLE cars(
car_id INT PRIMARY KEY,
make VARCHAR(50),
type VARCHAR(50),
style VARCHAR(50),
cost_$ INT
);
INSERT INTO cars
(car_id, make, type, style, cost_$)
VALUES 
(1, 'Honda', 'Civic', 'Sedan', 30000),
(2, 'Toyota', 'Corolla', 'Hatchback', 25000),
(3, 'Ford', 'Explorer', 'SUV', 40000),
(4, 'Chevrolet', 'Camaro', 'Coupe', 36000),
(5, 'BMW', 'X5', 'SUV', 55000),
(6, 'Audi', 'A4', 'Sedan', 48000),
(7, 'Mercedes', 'C-Class', 'Coupe', 60000),
(8, 'Nissan', 'Altima', 'Sedan', 26000);

CREATE table sales(
sale_id int primary key,
car_id int, 
salesman_id int,
purchase_date date,
FOREIGN KEY (car_id) REFERENCES cars(car_id),
FOREIGN KEY (salesman_id) REFERENCES salespersons(salesman_id)
);
INSERT into sales
(sale_id, car_id, salesman_id, purchase_date)
values
(1,1,1, '2021-01-01'),
(2, 3,3,'2021-02-03'),
(3, 2, 2, '2021-02-10'),
(4, 5, 4, '2021-03-01'),
(5, 8, 1, '2021-04-02'),
(6, 2, 1, '2021-05-05'),
(7, 4, 2, '2021-06-07'),
(8, 5, 3, '2021-07-09'),
(9, 2, 4, '2022-01-01'),
(10, 1, 3, '2022-02-03'),
(11, 8, 2, '2022-02-10'),
(12, 7, 2, '2022-03-01'),
(13, 5, 3, '2022-04-02'),
(14, 3, 1, '2022-05-05'),
(15, 5, 4, '2022-06-07'),
(16, 1, 2, '2022-07-09'),
(17, 2, 3, '2023-01-01'),
(18, 6, 3, '2023-02-03'),
(19, 7, 1, '2023-02-10'),
(20, 4, 4, '2023-03-01');

#What are the details of all cars purchased in the year 2022?
select make, type, style, cost_$,purchase_date
from sales
left join cars
on sales.car_id = cars.car_id
where purchase_date like '2022%';

# What is the total number of cars sold by each salesperson?
select sp.name, count(car_id) as no_of_cars_sold
from sales as s
left join salespersons as sp
on s.salesman_id = sp.salesman_id
group by sp.name;

#What is the total revenue generated by each salesperson?
select sp.name, sum(cost_$) as revenue
from sales as s
inner join cars as c
on s.car_id = c.car_id
Inner join salespersons as sp
on s.salesman_id = sp.salesman_id
Group by sp.salesman_id
order by sum(cost_$) asc;

#What are the details of the cars sold by each salesperson?
select name,purchase_date, make, type, style, cost_$
from cars as c
inner join sales as s
on c.car_id = s.car_id
inner join salespersons as sp
on s.salesman_id = sp.salesman_id
order by name asc;

#What is the total revenue generated by each car type?
select (cost_$ * count(sale_id)) as revenue, c.type
from cars as c
inner join sales as s
on c.car_id = s.car_id
group by c.typemakemake
order by (cost_$* sale_id) asc;

#What are the details of the cars sold in the year 2021 by salesperson 'Emily Wong'?
SELECT sp.name, s.sale_id, s.purchase_date, c.car_id, c.make, c.type, c.style, c.cost_$
from cars as c
inner join sales as s
on c.car_id = s.car_id
INNER join salespersons as sp
on s.salesman_id = sp.salesman_id
where sp.name = "Emily Wong" and purchase_date like "2021%";

#What is the total revenue generated by the sales of hatchback cars?
SELECT c.style, sum(cost_$) as revenue
from cars as c
INNER JOIN sales as s
on c.car_id = s.car_id
WHERE c.style = 'Hatchback';

#What is the total revenue generated by the sales of SUV cars in the year 2022?
SELECT c.style, sum(c.cost_$) as total_revenue
FROM sales as s
LEFT JOIN cars as c
on s.car_id = c.car_id
WHERE c.style = 'SUV' and s.purchase_date like '2022%';

#What is the name & city of the salesperson who sold the most number of cars in the year 2023?
SELECT sp.name, sp.city,COUNT(s.sale_id) as no_of_cars_sold
FROM sales as s
LEFT JOIN salespersons as sp
on s.salesman_id = sp.salesman_id
where purchase_date like '2023%'
GROUP by sp.city
ORDER by COUNT(s.sale_id) desc
LIMIT 1;

#What is the name & age of the salesperson who generated the highest revenue in the year 2022?
SELECT sp.name, sp.age, sum(cost_$) as revenue
FROM cars as c
LEFT JOIN sales as s
on c.car_id = s.car_id
LEFT JOIN salespersons as sp
on sp.salesman_id = s.salesman_id
WHERE purchase_date like '2022%'
GROUP by sp.name, sp.age
ORDER by sum(cost_$) DESC
LIMIT 1;